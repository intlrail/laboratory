/*!
 * World JS: History Simulation
 * Version 3.0.0
 *
 * https://github.com/anvoz/world-js
 * Copyright (c) 2013-2014 An Vo - anvo4888@gmail.com
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php)
 */
define(function(a){"use strict";var b=a("./event"),c=a("./female"),d=a("./male"),e=a("./seed"),f=a("./tile"),g=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(+new Date)},1e3/60)}}(),h=function(){var a=this;a.running=!1,a.stopCallback=function(){},a.width=640,a.height=360,a.padding=10,a.canvas={wrapper:!1,context:!1},a.sprite={src:"images/icons.png",image:!1},a.displayMode="full",a.totalSeeds=0,a.nextSeedId=1,a.maxSafeSeedsForDisplay=3e4,a.tickPerYear=60,a.speed=1,a.tickMod=0,a.distributedTicks=[];for(var e=0;e<a.tickPerYear-1;e++)a.distributedTicks.push(0);a.lastTickTime=0,a.fps=0,a.event=new b(a),a.Female=c,a.Male=d,a.tile=new f(a)};return h.prototype.init=function(a){var b=this,c=document.createElement("canvas"),d=document.getElementById(a),e=d.clientWidth||b.width,f=d.clientHeight||b.height;b.canvas.wrapper=d,b.width=c.width=e,b.height=c.height=f,d.appendChild(c),b.canvas.context=c.getContext("2d");var g=new Image;return g.src=b.sprite.src,b.sprite.image=g,b.tile.init(e,f),b},h.prototype.addSeed=function(a,b){b=b||{};var c=this,d=new a(b);c.totalSeeds++,d.world=c,d.id=c.nextSeedId++,d.age=b.age||0,d.tickCount=d.age>0?d.age*c.tickPerYear:d.tickCount;var e=c.getTickIndex();c.distributedTicks[e]++,d.tickIndex=e,d.tickMod=c.tickMod,d.tickCount+=(c.tickMod+d.tickCount+d.tickIndex)%d.actionInterval,d.stepCount=d.tickCount,d.moveUntilStep=d.moveUntilStep||d.tickCount+c.random(2,10)*d.jumpInterval;var f=c.getRandomPosition(d);return d.x=f.x,d.y=f.y,d.tileIndex=c.tile.getIndex(d),c.tile.set(d),c.event.trigger("seedAdded",{seed:d,mother:b.mother||void 0}),d},h.prototype.getTickIndex=function(){for(var a=this,b=a.distributedTicks,c=0,d=b[c],e=0,f=b.length;f>e;e++)b[e]<d&&(c=e,d=b[e]);return c},h.prototype.getRandomPosition=function(a,b){b=b||!1;var c=this,d=a.x===!1||b?c.random(c.padding,c.width-a.icon.width-c.padding):a.x,e=a.y===!1||b?c.random(c.padding,c.height-a.icon.height-c.padding):a.y;return{x:d,y:e}},h.prototype.removeSeed=function(a){var b=this;return b.totalSeeds--,b.event.trigger("seedRemoved",{seed:a}),a.relationSeed!==!1&&(a.relationSeed.relationSeed=!1,a.relationSeed=!1),b.tile.rem(a),b.distributedTicks[a.tickIndex]--,b},h.prototype.addSeeds=function(a,b){b=b||{};for(var c=this,d="undefined"!=typeof b.types?b.types:[e],f="undefined"!=typeof b.minAge?b.minAge:15,g="undefined"!=typeof b.maxAge?b.maxAge:20,h=0;a>h;h++){var i=c.random(f,g),j={x:!1,y:!1,age:i};if("undefined"!=typeof b.fromBorder){var k=["top","bottom","left","right"],l="random"===b.fromBorder?k[c.random(0,3)]:b.fromBorder;switch(l){case"top":j.y=c.random(0,c.padding);break;case"bottom":j.y=c.random(c.height-c.padding-1,c.height-1);break;case"left":j.x=c.random(0,c.padding);break;case"right":j.x=c.random(c.width-c.padding-1,c.width-1)}}c.addSeed(d[h%d.length],j)}return c},h.prototype.run=function(a){var b=this,c=b.canvas.context,d=b.sprite.image;b.tickMod=++b.tickMod%b.tickPerYear;var e=0===b.tickMod,f=b.totalSeeds<=b.maxSafeSeedsForDisplay||e;f&&c.clearRect(0,0,b.width,b.height);for(var h=b.tile.list,i=b.tile.maxDisplayedSeeds,j=b.speed,k=0,l=h.length;l>k;k++)for(var m=h[k],n=0,o=0,p=m.length;p>o;o++)if(m[o]){var q=m[o],r=q.tileIndex;if(q.tickMod==b.tickMod)continue;if(q.tickMod=b.tickMod,e&&q.age++,f&&i>n){switch(b.displayMode){case"full":q.draw(c,d);break;case"dot":q.draw(c,!1);break;case"none":}n++}q.tick(j);var s=b.tile.getIndex(q);s!==r&&(b.tile.rem(q),q.tileIndex=s,b.tile.set(q))}return e&&(b.event.trigger("yearPassed"),0===b.totalSeeds)?void(b.running=!1):(b.running?(b.fps=1e3/(a-b.lastTickTime),b.lastTickTime=a,g(function(){b.run.call(b)})):(b.stopCallback.call(b),b.stopCallback=function(){}),b)},h.prototype.start=function(){var a=this;return a.running=!0,a.run(),a},h.prototype.stop=function(a){var b=this;return b.running=!1,"function"==typeof a&&(b.stopCallback=a),b},h.prototype.random=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},h}),define(function(){"use strict";var a=function(a){var b=this;b.world=a,b.list=[],b.availableArrayIndexes=[],b.size=20,b.maxDisplayedSeeds=7,b.totalTiles=!1,b.tilesPerRow=!1,b.tilesPerCol=!1};return a.prototype.init=function(a,b){var c=this,d=c.size,e=Math.ceil(b/d),f=Math.ceil(a/d),g=e*f;c.tilesPerRow=e,c.tilesPerCol=f,c.totalTiles=g;for(var h=c.list,i=c.availableArrayIndexes,j=0;g>j;j++)h.push([]),i.push([])},a.prototype.getIndex=function(a){var b=this.size,c=Math.floor(a.x/b),d=Math.floor(a.y/b);return c+d*this.tilesPerCol},a.prototype.set=function(a){var b=this,c=a.tileIndex,d=b.list[c],e=b.availableArrayIndexes[c];e.length>0?(a.tileArrayIndex=e.pop(),d[a.tileArrayIndex]=a):(a.tileArrayIndex=d.length,d.push(a))},a.prototype.rem=function(a){var b=this,c=a.tileIndex,d=a.tileArrayIndex;b.list[c][d]=!1,b.availableArrayIndexes[c].push(d)},a}),define(function(){"use strict";var a=function(a){var b=this;b.world=a,b.list={yearPassed:{},seedAdded:{},seedRemoved:{}}};return a.prototype.add=function(a,b,c){this.list[a][b]=c},a.prototype.remove=function(a,b){delete this.list[a][b]},a.prototype.trigger=function(a,b){var c=this,d=c.world,e=c.list[a];for(var f in e)e.hasOwnProperty(f)&&e[f].call(d,b)},a}),define(function(){"use strict";var a=function(a){var b=this;b.world=!1,b.id=!1,b.tileIndex=!1,b.tickIndex=!1,b.tickMod=!1,b.age=a.age||0,b.x="undefined"==typeof a.x?!1:a.x,b.y="undefined"==typeof a.y?!1:a.y,b.icon=a.icon||{width:1,height:1},b.carrying=a.carrying||!1,b.relationSeed=a.relationSeed||!1,b.tickCount=a.tickCount||0,b.actionInterval=a.actionInterval||30,b.stepCount=b.tickCount,b.jumpInterval=20,b.moveUntilStep=a.moveUntilStep||0,b.ageToMoveAgain=0,b.isMoving=!1,b.moveTo=a.moveTo||!1};return a.prototype.draw=function(a,b){var c=this;if(b===!1||1===c.icon.width){var d=b!==!1?c.icon.width:1,e=b!==!1?c.icon.height:1;a.fillRect(c.x,c.y,d,e)}else{var f=c.age<=c.maxChildAge?c.icon.child:c.icon,g=c.jumpInterval,h=10,i=c.stepCount%g,j=h>i?i+1:h-i%h-1;if(a.drawImage(b,f.x,f.y,f.width,f.height,c.x,c.y-j,f.width,f.height),c.carrying!==!1&&"none"!==c.carrying){var k=c.carrying;a.drawImage(b,k.x,k.y,k.width,k.height,c.x+k.dx,c.y-j+k.dy,k.width,k.height)}}},a.prototype.getCarryingItem=function(a,b){var c=this,d=c.world;if("undefined"!=typeof d.items){var e=d.items,f=[];for(var g in e){var h=e[g];h.enabled===!0&&h.who===a&&h.when===b&&f.push(h.icon)}var i=f.length;if(1===i)return f[0];if(i>1)return f[d.random(0,i-1)]}return!1},a.prototype.move=function(a,b){var c=this,d=c.world,e=d.random;if(c.isMoving=!0,b)b.call(c);else if(c.stepCount>=c.moveUntilStep){if(0===c.ageToMoveAgain||c.ageToMoveAgain>c.age)return 0===c.ageToMoveAgain&&(c.ageToMoveAgain=c.age+e(2,c.age),c.carrying=!1),void(c.isMoving=!1);c.ageToMoveAgain=0,c.moveUntilStep=c.stepCount+e(2,10)*c.jumpInterval,c.carrying=!1}(c.moveTo===!1||c.moveTo.x===c.x&&c.moveTo.y===c.y)&&(c.moveTo=d.getRandomPosition(c,!0)),c.stepCount++,c.x<c.moveTo.x?c.x=Math.min(c.x+a,c.moveTo.x):c.x>c.moveTo.x&&(c.x=Math.max(c.x-a,0)),c.y<c.moveTo.y?c.y=Math.min(c.y+a,c.moveTo.y):c.y>c.moveTo.y&&(c.y=Math.max(c.y-a,0))},a.prototype.seek=function(a){var b=this,c=b.world.tile,d=[[0,0],[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];a||(a=function(a){return a.id!=b.id});for(var e=c.tilesPerRow,f=c.tilesPerCol,g=0,h=d.length;h>g;g++){var i;if(0===g)i=b.tileIndex;else{var j=b.tileIndex%e+d[g][0],k=Math.floor(b.tileIndex/e)+d[g][1];if(!(j>=0&&e>j&&k>=0&&f>k))continue;i=j+k*e}for(var l=c.list[i],m=0,n=l.length;n>m;m++)if(l[m]&&b.id!=l[m].id){var o=l[m];if(a.call(b,o))return o}}return!1},a.prototype.tick=function(a){var b=this;b.tickCount++,b.move(a)},a.prototype.getChance=function(a){for(var b=this,c=b.chances[a],d=b.age,e=0,f=0,g=0,h=0;c[e]&&d>=c[e].range[0];){var i=c[e];f=i.range[0],g=i.from,h=(i.to-i.from)/(i.range[1]-i.range[0]),e++}return g+(d-f)*h},a}),define(function(a){"use strict";var b=a("./seed"),c=function(a){var c=this;a.icon={x:0,y:0,width:13,height:20,child:{x:26,y:0,width:11,height:10}},b.call(c,a),c.maxChildAge=15,c.chances=a.chances||{death:[{range:[1,20],from:.02,to:.01},{range:[20,60],from:.01,to:.02},{range:[60,80],from:.02,to:.05},{range:[80,100],from:.05,to:.9}],marriage:[{range:[15,30],from:.1,to:.5},{range:[30,50],from:.5,to:.1},{range:[50,80],from:.1,to:.01}]}};return c.prototype=Object.create(b.prototype),c.prototype.contructor=c,c.prototype.tick=function(a){var b=this,c=b.world;b.tickCount++;var d=b.actionInterval/a;if(b.tickCount%d===d-1){var e=b.getChance("death");if(e>0&&Math.random()<e)return void c.removeSeed(b);if(b.relationSeed===!1&&b.age>=b.chances.marriage[0].range[0]){var f=b.getChance("marriage");if(f>0){var g=Math.random();if(f>g){var h=b.seek(function(a){var b=this,c=b.world;return a instanceof c.Female&&a.relationSeed===!1&&a.age>=a.chances.childbirth[0].range[0]&&(a.age<=b.age||g*Math.ceil((a.age-b.age)/10)<f)});h!==!1&&(b.relationSeed=h,h.relationSeed=b,"undefined"==typeof h.totalChildren&&(h.totalChildren=0),h.ageLastBear=h.age+1,b.carrying=!1,h.carrying=!1)}}}}if(b.relationSeed!==!1){if(b.x===Math.max(0,b.relationSeed.x-10)&&b.y===b.relationSeed.y)return;b.move(a,function(){var a=this,b=a.relationSeed;a.moveTo.x=Math.max(a.world.padding,b.x-10),a.moveTo.y=b.y})}else b.move(a,!1);if(b.carrying===!1&&"undefined"!=typeof c.items)if(Math.random()<.2){if(b.age>b.maxChildAge){var i=b.relationSeed===!1?"man":"husband",j=b.isMoving?"moving":"standing";b.carrying=b.getCarryingItem(i,j)}}else b.carrying="none"},c}),define(function(a){"use strict";var b=a("./seed"),c=function(a){var c=this;a.icon={x:13,y:0,width:13,height:20,child:{x:26,y:10,width:11,height:10}},b.call(c,a),c.maxChildAge=15,c.totalChildren=void 0,c.ageLastBear=0,c.chances=a.chances||{death:[{range:[1,25],from:.02,to:.01},{range:[25,65],from:.01,to:.02},{range:[65,85],from:.02,to:.05},{range:[85,105],from:.05,to:.9}],childbirth:[{range:[15,25],from:.1,to:.25},{range:[25,50],from:.25,to:.1},{range:[50,70],from:.1,to:.001}]}};return c.prototype=Object.create(b.prototype),c.prototype.contructor=c,c.prototype.tick=function(a){var b=this,c=b.world;b.tickCount++;var d=b.actionInterval/a;if(b.tickCount%d===d-1){var e=b.age,f=b.getChance("death");if(f>0&&Math.random()<f)return void c.removeSeed(b);if(b.relationSeed!==!1&&e>=b.chances.childbirth[0].range[0]&&e>b.ageLastBear){var g=b.getChance("childbirth");if(g>0&&Math.random()<g){b.ageLastBear=e+1,b.totalChildren++;var h={x:b.x,y:Math.min(c.height-1-c.padding,b.y+Math.floor(b.icon.height/2)),mother:b};Math.random()<.5?c.addSeed(c.Male,h):c.addSeed(c.Female,h)}}}if(b.move(a,!1),b.carrying===!1&&"undefined"!=typeof c.items)if(Math.random()<.2){if(b.age>b.maxChildAge){var i=b.relationSeed===!1?"woman":"wife",j=b.isMoving?"moving":"standing";b.carrying=b.getCarryingItem(i,j)}}else b.carrying="none"},c}),define(function(){"use strict";var a=function(a){var b=this;b.world=a,b.year=0,b.population=0,b.men=0,b.women=0,b.boys=0,b.girls=0,b.families=0,b.maxAge=0,b.yearMaxAge=0,b.die=0,b.sumAge=0,b.avgChildren=0;var c=a.event;c.add("yearPassed","statistic",function(){this.statistic.yearPassed()}),c.add("seedRemoved","statistic",function(a){this.statistic.seedRemoved(a.seed)})};return a.prototype.seedRemoved=function(a){var b=this;b.die++;var c=a.age;c>b.maxAge&&(b.maxAge=c,b.yearMaxAge=b.year),b.sumAge+=c},a.prototype.yearPassed=function(){for(var a=this,b=a.world,c=b.tile.list,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=c.length;l>k;k++)for(var m=c[k],n=0,o=m.length;o>n;n++)if(m[n]){var p=m[n];d++,p instanceof b.Male?p.age<=p.maxChildAge?g++:(e++,p.relationSeed!==!1&&i++):p.age<=p.maxChildAge?h++:(f++,"undefined"!=typeof p.totalChildren&&(j+=p.totalChildren))}a.year++,a.population=d,a.men=e,a.women=f,a.boys=g,a.girls=h,a.families=i,a.avgChildren=Math.floor(j/f)||0},a}),define(function(a){"use strict";var b=a("./seed"),c=function(a){var c=this;c.world=a,c.population={limit:100},c.chance={death:0,marriage:0,childbirth:0},c.chanceIncr={death:0,marriage:0,childbirth:0},c.food={adult:1,child:-1,resourceIncr:0,min:-1e4},c.famine={deathChanceIncr:.1,unit:-100},c.foodSpoilage={foodDecr:.9,interval:1},c.largeCooperation={deathChanceIncr:.1,unit:1};var d=a.statistic;d.food=0,d.foodResource=500;var e=a.event;e.add("yearPassed","rules",function(){var a=this;a.rules.change()});var f=b.prototype.getChance;b.prototype.getChance=function(a){var b=this,c=b.world,d=c.rules,e=f.call(b,a);return"undefined"!=typeof d.chance[a]&&0!==d.chance[a]&&(e+=e*d.chance[a]),e}};return c.prototype.change=function(){var a=this,b=a.world,c=b.statistic,d=c.food,e=c.foodResource,f=c.population,g=c.men+c.women,h=c.boys+c.girls,i=Math.min(e,g*a.food.adult),j=h*a.food.child,k=i+j;e=Math.max(0,e-i),d+=k,d<a.food.min&&(d=a.food.min);var l=0,m=0;d<=a.famine.unit&&(m=Math.floor(d/a.famine.unit),l+=m*a.famine.deathChanceIncr),c.year%a.foodSpoilage.interval===0&&d>0&&(d-=Math.floor(d*a.foodSpoilage.foodDecr)),f>a.population.limit&&(m=f-a.population.limit,m=Math.floor(m/a.largeCooperation.unit),l+=m*a.largeCooperation.deathChanceIncr),c.food=d,c.foodResource=e,a.chance.death=l+a.chanceIncr.death},c}),define(function(){"use strict";var a=function(a){var b=this;b.world=a,b.list={},b.trending=[],b.trendingAdded=function(){},b.trendingRemoved=function(){},b.completed=[];var c=a.statistic;c.iq=0,c.maxIQ=0,c.yearMaxIQ=0;var d=a.rules;d.baseIQ=0;var e=a.event;e.add("seedAdded","knowledge",function(a){this.knowledge.seedAdded(a)}),e.add("seedRemoved","knowledge",function(a){this.knowledge.seedRemoved(a)}),e.add("yearPassed","knowledge",function(){this.knowledge.gain()})};return a.prototype.seedAdded=function(a){var b=a.seed,c=b.world;"undefined"!=typeof a.mother&&(b.iq=Math.round((a.mother.relationSeed.iq+a.mother.iq)/2)),b.iq=b.iq||0,b.iq+=c.random(0,3),b.iq+=c.rules.baseIQ;var d=c.statistic;d.iq+=b.iq,b.iq>d.maxIQ&&(d.maxIQ=b.iq,d.yearMaxIQ=d.year)},a.prototype.seedRemoved=function(a){var b=a.seed,c=b.world;c.statistic.iq-=b.iq},a.prototype.gain=function(){var a,b,c=this,d=c.world,e=d.statistic.year,f=d.statistic.iq,g=[],h=0,i=!1;for(a=0,b=c.trending.length;b>=a;a++)g[a]=d.random(0,100),b>a&&(i=c.list[c.trending[a]],1!=i.iq.priority&&(g[a]*=i.iq.priority)),h+=g[a];var j={.1:.01,1:.05,2:.1},k=[],l=[],m=[];for(a=0,b=c.trending.length;b>a;a++){i=c.list[c.trending[a]];var n=f*g[a]/h,o=i.iq.gained;o+=Math.floor(Math.min(i.iq.required*j[i.iq.priority],n)),isNaN(o)&&(o=i.iq.gained),o>=i.iq.required?(i.iq.gained=i.iq.required,l.push.apply(l,i.following),i.affectedYear=e,"function"==typeof i.onAffected&&i.onAffected(d),m.push(i)):(i.iq.gained=o,k.push(i.id))}if(m.length>0){for(a=0;a<m.length;a++)c.trendingRemoved(m[a]),c.completed.push(m[a]);for(a=0;a<l.length;a++)c.trendingAdded(c.list[l[a]]),k.push(l[a]);c.trending=k}},a}),define(function(a){"use strict";var b=a("./language/en"),c={huga:{id:"huga",name:b.knowledgeHUGAName,message:b.knowledgeHUGAMessage,description:[{text:b.knowledgeHUGADescription01,code:["Adult +1 food / year","Food resource +10k"]}],iq:{priority:1,gained:0,required:500},following:["fire","hula"],affectedYear:0,onAffected:function(a){var b=a.statistic;a.rules.food.adult+=1,b.foodResource+=1e4,b.food<0&&(b.foodResource+=b.food,b.food=0),a.items.meat.enabled=!0,a.items.fruit.enabled=!0}},fire:{id:"fire",name:b.knowledgeFIREName,message:b.knowledgeFIREMessage,description:[{text:b.knowledgeFIREDescription01,code:["Death rate -10%"]},{text:b.knowledgeFIREDescription02,code:["Base IQ +1"]},{text:b.knowledgeFIREDescription03,code:["Food resource recovery -5% / century"]}],iq:{priority:.1,gained:0,required:3e3},following:["cook","noma"],affectedYear:0,onAffected:function(a){var b=a.rules;b.chanceIncr.death-=.1,b.baseIQ+=1,a.event.add("yearPassed","burningForests",function(){var a=this,b=a.statistic.year,c=a.knowledge.list.fire.affectedYear;b%100==c%100&&b>c&&(a.rules.food.resourceIncr-=.1)}),a.items.fire.enabled=!0}},hula:{id:"hula",name:b.knowledgeHULAName,message:b.knowledgeHULAMessage,description:[{text:b.knowledgeHULADescription01,code:["Death rate +10%","Adult +2 food / year","Food resource +5k"]},{text:b.knowledgeHULADescription02,code:["Food resource recovery -5% / century"]}],iq:{priority:.1,gained:0,required:2e4},following:[],affectedYear:0,onAffected:function(a){var b=a.rules,c=a.statistic;b.chanceIncr.death+=.1,b.food.adult+=2,c.foodResource+=5e3,c.food<0&&(c.foodResource+=c.food,c.food=0),a.event.add("yearPassed","largeAnimalsDisappearing",function(){var a=this,b=a.statistic.year,c=a.knowledge.list.hula.affectedYear;b%100==c%100&&b>c&&(a.rules.food.resourceIncr-=.1)})}},noma:{id:"noma",name:b.knowledgeNOMAName,message:b.knowledgeNOMAMessage,description:[{text:b.knowledgeNOMADescription01,code:["Enable food resource recovery"]},{text:b.knowledgeNOMADescription02,code:["Death rate -10%"]}],iq:{priority:.1,gained:0,required:5e4},following:["osea"],affectedYear:0,onAffected:function(a){a.event.add("yearPassed","foodResourceRecovering",function(){var a=this,b=a.statistic.year,c=a.knowledge.list.noma.affectedYear;if(b%10==c%10&&b>c){var d=a.rules,e=10*d.population.limit*d.food.adult;e=Math.max(0,e+Math.ceil(e*d.food.resourceIncr)),a.statistic.foodResource=e}}),a.rules.chanceIncr.death-=.1}},cook:{id:"cook",name:b.knowledgeCOOKName,message:b.knowledgeCOOKMessage,description:[{text:b.knowledgeCOOKDescription01,code:["Adult +1 food / year","Food resource +20k"]},{text:b.knowledgeCOOKDescription02,code:["Base IQ +1"]},{text:b.knowledgeCOOKDescription03,code:["Death rate -10%","Food spoilage -10%"]}],iq:{priority:.1,gained:0,required:5e3},following:[],affectedYear:0,onAffected:function(a){var b=a.rules,c=a.statistic;b.food.adult+=1,c.foodResource+=2e4,c.food<0&&(c.foodResource+=c.food,c.food=0),b.baseIQ+=1,b.chanceIncr.death-=.1,b.foodSpoilage.foodDecr-=.1,a.items.pot.enabled=!0}},goss:{id:"goss",name:b.knowledgeGOSSName,message:b.knowledgeGOSSMessage,description:[{text:b.knowledgeGOSSDescription01,code:["Population limit 150","Base IQ +1","Child -1 food / year"]}],iq:{priority:.1,gained:0,required:1e4},following:[],affectedYear:0,onAffected:function(a){var b=a.rules;b.population.limit=150,b.baseIQ+=1,b.food.child-=1,a.padding=10}},spir:{id:"spir",name:b.knowledgeSPIRName,message:b.knowledgeSPIRMessage,description:[{text:b.knowledgeSPIRDescription01,code:["Population limit 500","Base IQ +1","Child -1 food / year"]},{text:b.knowledgeSPIRDescription02,code:["Death rate +10%"]}],iq:{priority:.1,gained:0,required:5e4},following:[],affectedYear:0,onAffected:function(a){var b=a.rules;b.population.limit=500,b.baseIQ+=1,b.food.child-=1,b.chanceIncr.death+=.1}},osea:{id:"osea",name:b.knowledgeOSEAName,message:b.knowledgeOSEAMessage,description:[{text:b.knowledgeOSEADescription01,code:["Food resource +10k","Food resource recovery +20%"]},{text:b.knowledgeOSEADescription02,code:["Death rate +0%"]}],iq:{priority:.1,gained:0,required:2e5},following:[],affectedYear:0,onAffected:function(a){var b=a.statistic;b.foodResource+=1e4,b.food<0&&(b.foodResource+=b.food,b.food=0),a.rules.food.resourceIncr+=.2}},coso:{id:"coso",name:b.knowledgeCOSOName,description:[{text:b.knowledgeCOSODescription01,code:[]},{text:b.knowledgeCOSODescription02,code:[]},{text:b.knowledgeCOSODescription03,code:[]}],iq:{priority:.1,gained:0,required:1e9},following:[],affectedYear:0,onAffected:function(){}}};return c}),define(function(){"use strict";var a=function(a){var b=this;b.world=a,b.$container=void 0,b.queue=[]};return a.prototype.setContainer=function(a){this.$container=a},a.prototype.show=function(a,b){var c=this,d=c.world;if("undefined"!=typeof a)c.queue.push({message:a,ytl:b}),1==c.queue.length&&c.show();else if(c.queue.length>0){var e=c.queue[0],f=d.statistic.year+e.ytl;c.$container.html(e.message).animate({bottom:0},400),d.event.add("yearPassed","guide",function(){var a=this;a.statistic.year>=f&&(a.guide.hide(),a.event.remove("yearPassed","guide"))})}},a.prototype.hide=function(){var a=this,b=(a.world,a.$container);b.animate({bottom:-b.outerHeight()},400,"swing",function(){a.queue.shift(),a.show()})},a}),define(function(a){"use strict";var b=a("./language/en"),c={},d={statistic:{year:0,population:0,men:0,women:0,boys:0,girls:0,families:0,food:0,foodResource:0,iq:0,maxIQ:0,yearMaxIQ:0,maxAge:0,yearMaxAge:0,avgIQ:0,avgAge:0,avgChildren:0},rules:{adultFoodChange:0,childFoodChange:0,foodResourceRecovery:100,foodSpoilage:0,deathChance:0},knowledge:{knowledgeTrending:0,knowledgeHistory:0},misc:{labelPopulationLimit:!1,labelNotEnoughResource:!1,labelFamine:!1}};for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];f[g]={container:$("#world-"+g),value:h},-1!=$.inArray(g,["men","women","families","boys","girls"])&&(f[g+"-ex"]={container:$("#world-"+g+"-ex"),value:h})}}return d.set=function(a,b){b!=a.value&&(a.value=b,a.container.html(b))},d.toggleLabel=function(a,b){b!=a.value&&(a.value=b,b?a.container.removeClass("hide"):a.container.addClass("hide"))},c.knowledgePriorityHTML=function(a,b){b=b||!1;for(var c=[{name:"low",value:.1},{name:"normal",value:1},{name:"high",value:2}],d=['<span class="no-wrap">'],e=0;e<c.length;e++){var f=c[e],g=a.iq.priority===f.value?"checked ":"",h=b?"priority-radio-clone":"priority-radio",i=a.id+"-"+f.name,j=b?a.id+"-clone":a.id;d.push(['<label class="radio-inline">','<input type="radio" '+g,'class="'+h+" "+i+'" ','value="'+f.name+'" ','name="'+j+'">',f.name,"</label>"].join(""))}return d.push("</span>"),d.join("")},c.knowledgeDescriptionHTML=function(a){for(var b=a.description,c=[],d=0;d<b.length;d++){var e=b[d];c.push("<p>&bull; "+e.text),e.code.length>0&&c.push(" <code>"+e.code.join("</code> <code>")+"</code>"),c.push("</p>")}return c.join("")},c.trendingAdded=function(a){var b;switch(a.iq.priority){case.1:b="progress-bar progress-bar-danger";break;case 2:b="progress-bar";break;default:b="progress-bar progress-bar-info"}var e=d.knowledge,f=e.knowledgeTrending.container,g=" collapsed",h=" collapse";0===f.find(".knowledge-detail").filter(".in,.collapsing").length&&(g="",h=" in");var i="world-knowledge-"+a.id,j=['<div class="knowledge panel">','<a class="knowledge-name'+g+'" href="#'+i+'" ','data-parent="#world-knowledgeTrending" data-toggle="collapse">',a.name,'<span class="caret"></span>',"</a>",'<div class="knowledge-progress progress">','<div class="'+b+'"></div>',"</div>",'<div class="knowledge-detail panel-collapse'+h+'" id="'+i+'">','<div class="knowledge-iq">',"&bull; Require: ",'<span class="no-wrap">','<span class="knowledge-progress-iq">0</span> / ',a.iq.required+" IQ","</span>","</div>",'<div class="knowledge-priority">',"&bull; Priority: ",c.knowledgePriorityHTML(a),"</div>",'<div class="knowledge-description">',c.knowledgeDescriptionHTML(a),"</div>","</div>","</div>"].join("");f.append(j);var k=$("#"+i);e[a.id]={container:k,IQContainer:k.find(".knowledge-progress-iq"),barContainer:k.siblings(".knowledge-progress").find(".progress-bar")}},c.trendingRemoved=function(a){var b=d,e=b.knowledge[a.id];e.IQContainer.html(a.iq.required),e.barContainer.width("100%"),e.container.closest(".knowledge").remove(),delete b.knowledge[a.id];var f=['<div class="knowledge">','<div class="knowledge-name">',b.statistic.year.value+1+": "+a.name,"</div>",'<div class="knowledge-detail">','<div class="knowledge-description">',c.knowledgeDescriptionHTML(a),"</div>","</div>","</div>"].join("");b.knowledge.knowledgeHistory.container.prepend(f)},c.yearPassed=function(){var a=this,b=d,c=a.statistic,e=b.statistic;for(var f in e)if(e.hasOwnProperty(f))switch(f){case"avgIQ":var g=0===c.population?0:Math.round(c.iq/c.population);b.set(e.avgIQ,g);break;case"avgAge":var h=0===c.die?0:Math.round(c.sumAge/c.die);b.set(e.avgAge,h);break;default:b.set(e[f],c[f]),-1!=$.inArray(f,["men","women","families","boys","girls"])&&b.set(e[f+"-ex"],c[f])}var i=a.rules,j=b.rules;b.set(j.deathChance,(100*i.chance.death).toFixed()),b.set(j.adultFoodChange,i.food.adult),b.set(j.childFoodChange,i.food.child),b.set(j.foodSpoilage,(100*i.foodSpoilage.foodDecr).toFixed()),b.set(j.foodResourceRecovery,(100+100*i.food.resourceIncr).toFixed());for(var k=a.knowledge,l=0,m=k.trending.length;m>l;l++){var n=k.list[k.trending[l]],o=b.knowledge[n.id];o.IQContainer.html(n.iq.gained),o.barContainer.width(Math.round(n.iq.gained/n.iq.required*100)+"%")}var p=b.misc;b.toggleLabel(p.labelPopulationLimit,c.population>=i.population.limit),b.toggleLabel(p.labelNotEnoughResource,c.foodResource<75),b.toggleLabel(p.labelFamine,c.food<=i.famine.unit)},$(".js-statistic-toggle").each(function(){$(this).click(function(){var a=$("#world-statistic-container");a.is(":visible")?a.addClass("visible-lg"):a.removeClass("visible-lg")})}),$("#world-intro .item").each(function(a){var c=$(this);switch(a){case 0:c.find("blockquote").html(b.introPhysicsQuote+"<footer>"+b.introPhysicsAuthor+"</footer>"),c.find("p:first").html(b.introPhysics01.replace("Big Bang",'<span class="label label-danger">Big Bang</span>')),c.find("p:last").html(b.introPhysics02.replace("Physics",'<span class="label label-info">Physics</span>'));break;case 1:c.find("blockquote").html(b.introChemistryQuote+"<footer>"+b.introChemistryAuthor+"</footer>"),c.find("p:first").html(b.introChemistry01),c.find("p:last").html(b.introChemistry02.replace("Chemistry",'<span class="label label-info">Chemistry</span>'));break;case 2:c.find("blockquote").html(b.introBiologyQuote+"<footer>"+b.introBiologyAuthor+"</footer>"),c.find("p:first").html(b.introBiology01),c.find("p:last").html(b.introBiology02.replace("Biology",'<span class="label label-info">Biology</span>'));break;case 3:c.find("blockquote").html(b.introHistoryQuote+"<footer>"+b.introHistoryAuthor+"</footer>"),c.find("p:first").html(b.introHistory01.replace("Homo sapiens",'<span class="label label-danger">Homo sapiens</span>')),c.find("p:last").html(b.introHistory02.replace("History",'<span class="label label-info">History</span>'));break;case 4:c.find("p:first").html(b.introGame01.replace("World JS",'<span class="label label-danger">World JS</span>')),c.find("p:first").next().html(b.introGame02.replace("the cognitive revolution",'<span class="label label-info">the cognitive revolution</span>')),c.find("p:last").html(b.introGame03.replace("anvo4888@gmail.com",'<a href="mailto: anvo4888@gmail.com">anvo4888@gmail.com</a>'))}}),$("#world-intro").removeClass("hide").on("slid.bs.carousel",function(){var a=$(this),b=a.find(".content"),c=a.find(".prev"),d=a.find(".next");b.find(".item:first").hasClass("active")?c.addClass("disabled"):c.removeClass("disabled"),b.find(".item:last").hasClass("active")?(d.addClass("disabled"),$(".opacity").animate({opacity:1},"fast")):d.removeClass("disabled")}),c}),define(function(a){"use strict";var b=a("./guide"),c=a("./interface"),d=a("./knowledge"),e=a("./knowledge.data"),f=a("./language/en"),g=a("./rules"),h=a("./statistic"),i=a("./core"),j=new i,k=j.event,l=(j.statistic=new h(j),j.rules=new g(j)),m=j.knowledge=new d(j),n=j.guide=new b(j),o=j.story={knowledge:{addList:function(a){m.list=a},addTrending:function(a){m.trending=[a.id],c.trendingAdded(a)}},ui:{bindKnowledge:function(){m.trendingAdded=c.trendingAdded,m.trendingRemoved=function(a){c.trendingRemoved(a);var b=["<div><b>✓ "+a.name+"</b></div>","<div>"+a.message+"</div>"];if(a.following.length>0){b.push("<hr>"),b.push('<div class="knowledge-trending">');for(var d=0;d<a.following.length;d++){var e=m.list[a.following[d]];b.push(['<div class="knowledge-clone">',"<div><b>"+e.name+"</b></div>",'<div class="knowledge-priority">',"&bull; Priority: ",c.knowledgePriorityHTML(e,!0),"</div>","</div>"].join(""))}b.push("</div>")}switch(n.show(b.join(""),15),a.id){case"noma":$("#world-foodResourceRecovery").parent().removeClass("text-muted")}}},bindKnowledgePriorityRadio:function(){$(document).on("change",".priority-radio",function(){var a=$(this),b=a.attr("name"),c=a.val(),d=1,e="progress-bar progress-bar-info";switch(c){case"high":d=2,e="progress-bar";break;case"low":d=.1,e="progress-bar progress-bar-danger"}a.closest(".knowledge").find(".progress-bar").attr("class",e),$(".priority-radio-clone."+b+"-"+c).prop("checked",!0),j.knowledge.list[b].iq.priority=d}),$(document).on("change",".priority-radio-clone",function(){var a=$(this),b=a.attr("name").split("-").shift(),c=a.val();$(".priority-radio."+b+"-"+c).click()})},bindStartButton:function(){$("#world-start-btn").click(function(){$("#world-intro").addClass("hide"),$(".opacity").animate({opacity:1},"fast"),$("#world-pause-btn").prop("disabled",!1).click()}),$("#world-pause-btn").click(function(){j.running?(j.stop(),$(this).html("Play")):(j.start(),$(this).html("Pause"))})},bindDisplayButton:function(){$("#world-display-btns button").click(function(){var a=$(this),b=a.data("display");a.addClass("active").siblings(".active").removeClass("active"),j.displayMode=b})},bindSpeedButton:function(){$("#world-speed-btns button").click(function(){var a=$(this),b=a.data("speed");switch(a.addClass("active").siblings(".active").removeClass("active"),b){case 2:case 5:j.tickPerYear=60/b,j.speed=b;break;default:j.tickPerYear=60,j.speed=1}})}},event:{populationControl:function(){k.add("yearPassed","populationControl",function(){var a=this,b=a.statistic.year;if(30>=b)20==b&&a.addSeeds(30,{minAge:10,maxAge:30,fromBorder:"random",types:[a.Male,a.Female]});else{var c=a.statistic,d=a.rules;if(d.chance.childbirth=0,c.population<150&&c.food>d.famine.unit){var e=Math.min(150,d.population.limit)-c.population;e>0&&(d.chance.childbirth=Math.ceil(e/10))}b>1e3&&a.event.remove("yearPassed","populationControl")}})},populationLimitUnlock:function(){k.add("yearPassed","populationLimitUnlock",function(){var a=this,b=a.knowledge;if(!(b.completed.length<1))for(var d=[{id:"goss",population:50,message:f.knowledgeGOSSUnlock},{id:"spir",population:150,message:f.knowledgeSPIRUnlock}],e=0;e<d.length;e++){var g=d[e].id,h=b.list[g];if(a.statistic.population>=d[e].population&&!h.added){h.added=!0,b.trending.push(g),c.trendingAdded(h),a.guide.show(['<div class="knowledge-trending">','<div class="knowledge-clone">',"<div><b>"+h.name+"</b></div>",'<div class="knowledge-priority">',"&bull; Priority: ",c.knowledgePriorityHTML(h,!0),"</div>","</div>","</div>","<div>"+d[e].message+"</div>"].join(""),15),"spir"==g&&a.event.remove("yearPassed","populationLimitUnlock");break}}})},yearPassed:function(){k.add("yearPassed","default",function(){var a=this,b=a.knowledge,d=a.statistic;if(8==b.completed.length&&0===b.trending.length){var e="coso";b.trending.push(e),c.trendingAdded(b.list[e])}500==d.year&&a.guide.show(f.storyEnd01,250),0===d.population&&($("#world-pause-btn").prop("disabled","disabled"),a.stop(),a.guide.show(f.storyEnd02,1e3))})}},guide:{setup:function(){n.setContainer($("#world-container .guide"));for(var a=[{year:5,ytl:15,html:f.storyBegin01},{year:20,ytl:15,html:f.storyBegin02}],b=0;b<a.length;b++)!function(a){k.add("yearPassed","message-"+a.year,function(){var b=this;b.statistic.year==a.year&&(b.guide.show(a.html,a.ytl),b.event.remove("yearPassed","message-"+a.year))})}(a[b])}},world:{addFirstMen:function(){var a=30;j.addSeed(j.Male,{x:10,y:10,moveTo:{x:320,y:180},age:13,moveUntilStep:9999,chances:{death:[{range:[1,a],from:0,to:0},{range:[a,60],from:.01,to:.02},{range:[60,80],from:.02,to:.05},{range:[80,100],from:.05,to:.5}],marriage:[{range:[1,a],from:1,to:1}]}}),j.addSeed(j.Female,{x:630,y:350,moveTo:{x:320,y:180},age:13,moveUntilStep:9999,chances:{death:[{range:[1,a],from:0,to:0},{range:[a,65],from:.01,to:.02},{range:[65,85],from:.02,to:.05},{range:[85,105],from:.05,to:.5}],childbirth:[{range:[1,a],from:1,to:1}]}})},addItems:function(){j.items={meat:{enabled:!1,who:"man",when:"moving",icon:{x:37,y:0,dx:5,dy:8,width:11,height:10}},fruit:{enabled:!1,who:"woman",when:"moving",icon:{x:37,y:10,dx:5,dy:8,width:11,height:10}},fire:{enabled:!1,who:"man",when:"standing",icon:{x:48,y:0,dx:12,dy:12,width:11,height:10}},pot:{enabled:!1,who:"wife",when:"standing",icon:{x:48,y:10,dx:-2,dy:12,width:11,height:10}}}}}};k.add("yearPassed","updateUI",c.yearPassed),o.event.populationControl(),o.event.populationLimitUnlock(),o.event.yearPassed(),l.population.limit=50,o.knowledge.addList(e),o.knowledge.addTrending(m.list.huga),o.ui.bindKnowledge(),o.ui.bindKnowledgePriorityRadio(),o.guide.setup(),o.ui.bindStartButton(),o.ui.bindDisplayButton(),o.ui.bindSpeedButton(),j.init("world"),j.padding=50,o.world.addFirstMen(),o.world.addItems()
});